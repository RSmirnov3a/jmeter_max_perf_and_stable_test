
# MaxPerf

Цель:

- запустить тест
- найти точку деградации производительности

#### Расчет профиля нагрузки

Изначально нам максимум для нашего сервиса не известен, поэтому нагрузка задана согласно параметрам

    <id>MaxPerf</id>
    <properties>
        <isMaxPerf>1</isMaxPerf>
        <duration>300</duration>
        <tps>0.1</tps>
        <thread_count>250</thread_count>
        <title>MaxPerf</title>
    </properties>

Будет создаваться 250 потоков, каждый из которых выполняет по 0.1 транзакции в секунду.
То есть задан шаг нагрзки для одного клиента равный 10 секундам, за это время транзакция должна отработать полностью.
То есть точка деградации производительности ищется на интенсивности от 0 до 25 транзакций в сек.

Если такой профиль окажется слишком мал или слишком велик для вашего стенда, то его можно скорректировать.
Сделав потоков меньше или побольше.

#### Запустить тест поиска максимальной производительности

```
 mvn clean verify -P MaxPerf
```

Тест будет выполняться **5 минут**.
За результатами теста можно следить online: http://metrics.loadlab.ragozin.info:3000/d/JMeter

#### Найти
1. Точку деградации производительности.
2. Точку появления ошибок.
(возможно точки совпадают)

#### Определить максимальную интенсивность как:

3. Сценарии в сек
4. Сценарии в час

#### Сохранение результатов

5. Сохранить HTML-отчет из каталога \target\jmeter\results\start_page_test
6. Сохранить снимок Dashboard-а c результатами теста в Grafana
7. Убедиться, что в логе \target\jmeter\logs\start_page_test.jmx.log нет критичных ошибок
8. Сохранить системные метрики, попробовать определить что стало узким местом
9. Занести результаты теста в отчет-таблицу

# Stable

#### Расчет профиля нагрузки

Расчитать интенсивность, на которой будет проводиться тест стабильности, как 80% от теста максимальной производительности

Например, пусть она получилась равная 7.65

#### Запустить тест стабильности

```
 mvn clean verify -P Stable -Dtps=7.65
```

Тест будет выполняться **10 минут**.
За результатами теста можно следить online: http://metrics.loadlab.ragozin.info:3000/d/JMeter

#### Анализ результатов теста

Убедиться, что

1. Нет точки деградации производительности
2. Нет точки появления ошибок в ответах сервера
3. Нет ошибок в логе JMeter

Зафиксировать:

4. Время отклика
5. Утилизацию ресурсов

# Бонусное задание
# Имитация проведения регрессионного теста

Цель:

- имитировать доработку
- провести тест после доработки: MaxPerf и Stable
- выполнить сравнение тестов поиска MaxPerf до и после доработки
- выполнить сравнение тестов поиска Stable до и после доработки

#### Имитация доработки

Раскомментировать в сценарии секцию "Gravatar" (например сочетанием клавиш Ctrl+T на ней).

#### Проведение тестов

Считая эталонными тестами тесты MaxPerf и Stable проведенные ранее,
провести контрольные тесты MaxPerf с поиском точки деградации производительности и соответствующий тест Stable.

#### Сравнение результатов тестов

1. Используя доску Grafana сравнить результаты тестов MaxPerf : http://metrics.loadlab.ragozin.info:3000/d/jmeterCompare
2. Используя доску Grafana сравнить результаты тестов Stable : http://metrics.loadlab.ragozin.info:3000/d/jmeterCompare

#### Анализ результатов теста

Зафиксировать:

4. На сколько улучшился/ухудшился показатель максимальной производительности, пример: -200 транзакций в час (-20%)
5. На сколько улучшился/ухудшился показатель времени отклика, пример: +270 мсек (+18%)

